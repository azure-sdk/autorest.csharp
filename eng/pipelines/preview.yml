parameters:
- name: UseTypeSpecNext
  displayName: Use TypeSpec "next" version
  type: boolean
  default: false

resources:
  repositories:
    - repository: azure-sdk-tools
      type: github
      endpoint: Azure
      name: Azure/azure-sdk-tools
      ref: refs/heads/users/pahallis/cookiecutter
    - repository: sdk-repository
      type: github
      endpoint: Azure
      name: Azure/azure-sdk-for-net
      ref: refs/heads/users/pahallis/cookiecutter

pool:
  name: azsdk-pool-mms-win-2022-general
  vmImage: windows-2022

extends:
  template: eng/pipelines/templates/stages/archetype-autorest-preview.yml@azure-sdk-tools
  parameters:
    BuildAlphaVersion: true
    UseTypeSpecNext: ${{ parameters.UseTypeSpecNext }}
    IncludeTestStage: ${{ parameters.UseTypeSpecNext }}
    SelfRepositoryName: autorest.csharp
    Packages:
    - file: autorest-csharp-*.tgz
      type: npm
    - file: azure-tools-typespec-csharp-*.tgz
      type: npm
    - file: 'Microsoft.Azure.AutoRest.CSharp.*.nupkg'
      type: nuget
    PublishPackages: true
    PublishTarget: 'internal'
    PublishDependsOn:
    - Build

